<!DOCTYPE html>

<html>
<head>
  <title>finQuery.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>finQuery.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * Retrieve stock market figures from google finance.
 *
 * @module finQuery
 *
 * @param  {String} html
 * @return {String}
 
name
tickerSymbol
exchange
exchangeTimezone
price
priceChange
priceChangePercent
quoteTime		
*/</span>



<span class="hljs-keyword">var</span> cheerio = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cheerio'</span>);
<span class="hljs-keyword">var</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);

<span class="hljs-keyword">var</span> url=<span class="hljs-string">"https://www.google.co.uk/finance?q="</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>var query = “NASDAQ%3AAAPL”;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

<span class="hljs-keyword">var</span> Fin = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};

Fin.prototype.log = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">query</span>) </span>{
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'url is '</span>+ url + query);
	<span class="hljs-keyword">return</span>(url+query);

};


Fin.prototype.query = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">query</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>start timing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-built_in">console</span>.time(<span class="hljs-string">"webrequest"</span>);



	<span class="hljs-keyword">var</span> req = https.get((url+query), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>{
		
		<span class="hljs-keyword">var</span> body = <span class="hljs-string">""</span>;

		res.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">htmldata</span>) </span>{
			body += htmldata;
		});

		req.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
		  <span class="hljs-built_in">console</span>.error(e);
		});

	  	res.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"url:"</span> + url+query);
	    	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'No more data in response.'</span>);
	  		
	  		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"statusCodes:"</span> + res.statusCode);
			<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"headers:"</span> + res.headers);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>end timing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	  		<span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">"webrequest"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>manipulate DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			domFind(body);  	
		});
	});

};


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">domFind</span>(<span class="hljs-params">html</span>)</span>{
	<span class="hljs-keyword">var</span> $ = cheerio.load(html);

	<span class="hljs-keyword">var</span> name 				= $(<span class="hljs-string">"meta[itemprop=name]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> tickerSymbol		= $(<span class="hljs-string">"meta[itemprop=tickerSymbol]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> exchange 			= $(<span class="hljs-string">"meta[itemprop=exchange]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> exchangeTimezone	= $(<span class="hljs-string">"meta[itemprop=exchangeTimezone]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> price 				= $(<span class="hljs-string">"meta[itemprop=price]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> priceChange 		= $(<span class="hljs-string">"meta[itemprop=priceChange]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> priceChangePercent	= $(<span class="hljs-string">"meta[itemprop=priceChangePercent]"</span>).attr(<span class="hljs-string">"content"</span>);
	<span class="hljs-keyword">var</span> quoteTime			= $(<span class="hljs-string">"meta[itemprop=quoteTime]"</span>).attr(<span class="hljs-string">"content"</span>);

	
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"name:\t\t\t\""</span> + name + <span class="hljs-string">"\""</span>);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"tickerSymbol:\t\t"</span>+tickerSymbol);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"exchange:\t\t"</span>+exchange);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"exchangeTimezone:\t"</span>+exchangeTimezone);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"price:\t\t\t"</span>+price);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"priceChange:\t\t"</span>+priceChange);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"priceChangePercent:\t"</span>+priceChangePercent);
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"quoteTime:\t\t"</span>+quoteTime);

	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n\n"</span>);

}

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">new</span> Fin();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
